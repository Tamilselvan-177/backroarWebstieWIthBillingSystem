{% extends "base.twig" %}
{% block title %}Transfer History ‚Äî Admin{% endblock %}
{% block content %}
<section class="min-h-screen bg-gray-50 py-8">
  <div class="container mx-auto px-4 max-w-7xl">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 gap-4">
      <div class="flex items-start gap-4">
        <a href="{{ app_url }}/admin/stock/transfer"
           class="inline-flex items-center px-4 py-2.5 rounded-lg border-2 border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all mt-1">
          ‚Üê Back to Transfer
        </a>
        <div>
          <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">
            Admin / Stock Management
          </p>
          <h1 class="text-3xl font-bold text-gray-900 mb-1">
            üìã Transfer History
          </h1>
          <p class="text-sm text-gray-600">View all stock transfer records</p>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-base font-bold text-gray-900 mb-4">üîç Filter Transfers</h2>
      <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide">
            Source Shop
          </label>
          <select name="source_id" 
                  class="w-full px-4 py-2.5 rounded-lg border-2 border-gray-300 bg-white text-sm font-medium text-gray-900 focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-10 transition-all outline-none">
            <option value="">All Shops</option>
            {% for s in stores %}
              <option value="{{ s.id }}" {% if s.id == source_id %}selected{% endif %}>
                {{ s.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide">
            Destination Shop
          </label>
          <select name="dest_id" 
                  class="w-full px-4 py-2.5 rounded-lg border-2 border-gray-300 bg-white text-sm font-medium text-gray-900 focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-10 transition-all outline-none">
            <option value="">All Shops</option>
            {% for s in stores %}
              <option value="{{ s.id }}" {% if s.id == dest_id %}selected{% endif %}>
                {{ s.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide">
            Status
          </label>
          <select name="status" 
                  class="w-full px-4 py-2.5 rounded-lg border-2 border-gray-300 bg-white text-sm font-medium text-gray-900 focus:border-black focus:ring-2 focus:ring-black focus:ring-opacity-10 transition-all outline-none">
            <option value="">All Status</option>
            <option value="PENDING" {% if status == 'PENDING' %}selected{% endif %}>Pending</option>
            <option value="COMPLETED" {% if status == 'COMPLETED' %}selected{% endif %}>Completed</option>
            <option value="CANCELLED" {% if status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
          </select>
        </div>

        <div class="flex items-end">
          <button type="submit" 
                  class="w-full px-6 py-2.5 rounded-lg bg-black text-white text-sm font-bold hover:bg-gray-800 transition-all">
            Apply Filters
          </button>
        </div>
      </form>
    </div>

    <!-- Stats Summary -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-sm border-2 border-blue-200 p-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center">
            <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-semibold text-blue-700">Total Transfers</p>
            <p class="text-2xl font-bold text-blue-900">{{ total }}</p>
          </div>
        </div>
      </div>

      <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-sm border-2 border-green-200 p-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-green-600 flex items-center justify-center">
            <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-semibold text-green-700">This Page</p>
            <p class="text-2xl font-bold text-green-900">{{ transfers|length }}</p>
          </div>
        </div>
      </div>

      <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl shadow-sm border-2 border-purple-200 p-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-purple-600 flex items-center justify-center">
            <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-semibold text-purple-700">Current Page</p>
            <p class="text-2xl font-bold text-purple-900">{{ page }} / {{ total_pages }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Transfers List -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 border-b-2 border-gray-200 bg-gray-50">
        <h2 class="text-base font-bold text-gray-900">Transfer Records</h2>
      </div>
      
      {% if transfers and transfers|length > 0 %}
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 border-b-2 border-gray-200">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Transfer #</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">From ‚Üí To</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Items</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">By</th>
              <th class="px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for t in transfers %}
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="text-sm font-bold text-gray-900">{{ t.transfer_number }}</span>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm">
                  <p class="font-semibold text-gray-900">{{ t.source_name }}</p>
                  <p class="text-gray-500 flex items-center gap-1">
                    <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                    {{ t.dest_name }}
                  </p>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-bold">
                  {{ t.total_items }} items
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if t.status == 'COMPLETED' %}
                  <span class="px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold">
                    ‚úì Completed
                  </span>
                {% elseif t.status == 'PENDING' %}
                  <span class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-xs font-bold">
                    ‚è≥ Pending
                  </span>
                {% else %}
                  <span class="px-3 py-1 rounded-full bg-red-100 text-red-700 text-xs font-bold">
                    ‚úó Cancelled
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                {{ t.created_at|date('M d, Y') }}<br>
                <span class="text-xs text-gray-500">{{ t.created_at|date('g:i A') }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                {{ t.user_name ?? 'System' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right">
                <a href="{{ app_url }}/admin/stock/transfer/view?id={{ t.id }}" 
                   class="inline-flex items-center px-3 py-1.5 rounded-lg bg-gray-900 text-white text-xs font-bold hover:bg-gray-800 transition-all">
                  View Details ‚Üí
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if total_pages > 1 %}
      <div class="px-6 py-4 border-t-2 border-gray-200 bg-gray-50">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">
            Page {{ page }} of {{ total_pages }}
          </div>
          <div class="flex gap-2">
            {% if page > 1 %}
              <a href="?page={{ page - 1 }}{% if source_id %}&source_id={{ source_id }}{% endif %}{% if dest_id %}&dest_id={{ dest_id }}{% endif %}{% if status %}&status={{ status }}{% endif %}"
                 class="px-4 py-2 rounded-lg bg-white border-2 border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all">
                ‚Üê Previous
              </a>
            {% endif %}
            
            {% if page < total_pages %}
              <a href="?page={{ page + 1 }}{% if source_id %}&source_id={{ source_id }}{% endif %}{% if dest_id %}&dest_id={{ dest_id }}{% endif %}{% if status %}&status={{ status }}{% endif %}"
                 class="px-4 py-2 rounded-lg bg-black text-white text-sm font-medium hover:bg-gray-800 transition-all">
                Next ‚Üí
              </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}
      
      {% else %}
      <div class="p-12 text-center">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
        </svg>
        <p class="text-gray-500 font-medium">No transfer records found</p>
        <p class="text-sm text-gray-400 mt-1">Try adjusting your filters</p>
      </div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}